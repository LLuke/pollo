<?xml version="1.0"?>

<!-- This is a very simple schema (following NO standard schema syntax).
     It tells the editor:
       - which attributes may occur on which elements
       - optionally a list to select attribute values from (can be computed with an xpath-expression)
       - which child-elements are allowed on an element.

	 author: Bruno Dumon (bruno.dumon@advalvas.be)
-->

<schema xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	
	<element name="map:parameter">
		<attributes>
			<attribute name="name"/>
			<attribute name="value"/>
		</attributes>
	</element>

	<element name="map:generate">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:generators/map:generator/@name/text()"/>
			<attribute name="src"/>
		</attributes>
		<allowedsubelements names="map:parameter"/>
	</element>

	<element name="map:transform">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:transformers/map:transformer/@name/text()"/>
			<attribute name="src"/>
		</attributes>
		<allowedsubelements names="map:parameter"/>
	</element>

	<element name="map:serialize">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:serializers/map:serializer/@name/text()"/>
			<attribute name="mime-type"/>
			<attribute name="status-code"/>
		</attributes>
		<allowedsubelements names="map:parameter"/>
	</element>

	<element name="map:read">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:readers/map:reader/@name/text()"/>
			<attribute name="src"/>
			<attribute name="mime-type"/>
		</attributes>
		<allowedsubelements names=""/>
	</element>

	<element name="map:redirect-to">
		<attributes>
			<attribute name="uri"/>
			<attribute name="resource" readvaluesfrom="/map:sitemap/map:resources/map:resource/@name/text()"/>
			<attribute name="session" choosefrom="yes,no,true,false"/>
		</attributes>
		<allowedsubelements names=""/>
	</element>

	<element name="map:act">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:actions/map:action/@name/text()"/>
			<attribute name="set" readvaluesfrom="/map:sitemap/map:action-sets/map:action-set/@name/text()"/>
		</attributes>
		<allowedsubelements names="map:parameter,map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

	<element name="map:select">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:selectors/map:selector/@name/text()"/>
		</attributes>
		<allowedsubelements names="map:parameter,map:when,map:otherwise"/>
	</element>

	<element name="map:when">
		<attributes>
			<attribute name="test"/>
		</attributes>
		<allowedsubelements names="map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

	<element name="map:otherwise">
		<allowedsubelements names="map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

	<element name="map:match">
		<attributes>
			<attribute name="type" readvaluesfrom="/map:sitemap/map:components/map:matchers/map:matcher/@name/text()"/>
			<attribute name="pattern"/>
		</attributes>
		<allowedsubelements names="map:parameter,map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

	<element name="map:mount">
		<attributes>
			<attribute name="src"/>
			<attribute name="uri-prefix"/>
			<attribute name="reload-method" choosefrom="synchron,asynchron"/>
			<attribute name="check-reload" choosefrom="true,false,yes,no"/>
		</attributes>
		<allowedsubelements names=""/>
	</element>

	<element name="map:label">
		<attributes>
			<attribute name="name"/>
		</attributes>
		<allowedsubelements names="map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

	<element name="map:aggregate">
		<attributes>
			<attribute name="element"/>
			<attribute name="ns"/>
			<attribute name="prefix"/>
		</attributes>
		<allowedsubelements names="map:part"/>
	</element>

	<element name="map:part">
		<attributes>
			<attribute name="src"/>
			<attribute name="element"/>
			<attribute name="ns"/>
			<attribute name="prefix"/>
			<attribute name="strip-root"/>
		</attributes>
	</element>

	<element name="map:action-sets">
		<allowedsubelements names="map:action-set"/>
	</element>

	<element name="map:action-set">
		<attributes>
			<attribute name="name"/>
		</attributes>
		<allowedsubelements names="map:act"/>
	</element>

	<element name="map:views">
		<allowedsubelements names="map:view"/>
	</element>

	<element name="map:view">
		<attributes>
			<attribute name="name"/>
			<attribute name="from-label"/>
			<attribute name="from-position" choosefrom="first,last"/>
		</attributes>
		<allowedsubelements names="map:transform,map:serialize,map:select,map:match,map:act,map:label,map:aggregate"/>
	</element>

	<element name="map:pipelines">
		<allowedsubelements names="map:pipeline"/>
	</element>

	<element name="map:pipeline">
		<attributes>
			<attribute name="internal-only" choosefrom="yes,no,true,false" />
		</attributes>
		<allowedsubelements names="map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount,map:handle-errors"/>
	</element>

	<element name="map:resources">
		<allowedsubelements names="map:resource"/>
	</element>

	<element name="map:resource">
		<attributes>
			<attribute name="name"/>
		</attributes>
		<allowedsubelements names="map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

	<element name="map:handle-errors">
		<allowedsubelements names="map:generate,map:transform,map:serialize,map:select,map:match,map:act,map:redirect-to,map:read,map:label,map:aggregate,map:mount"/>
	</element>

</schema>
